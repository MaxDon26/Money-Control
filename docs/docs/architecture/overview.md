---
sidebar_position: 1
---

# Обзор архитектуры

## Общая схема

```
┌─────────────────────────────────────────────────────────────┐
│                        Frontend                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    React + Vite                       │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │  Pages  │ │ Widgets │ │Features │ │Entities │   │   │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘   │   │
│  │       └───────────┴──────────┬┴───────────┘         │   │
│  │                              │                       │   │
│  │  ┌───────────────────────────▼───────────────────┐  │   │
│  │  │              Shared (API, UI, Utils)           │  │   │
│  │  └───────────────────────────┬───────────────────┘  │   │
│  └──────────────────────────────┼──────────────────────┘   │
│                                 │ HTTP/REST                 │
└─────────────────────────────────┼───────────────────────────┘
                                  │
┌─────────────────────────────────▼───────────────────────────┐
│                         Backend                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                     NestJS                           │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │  Auth   │ │Accounts │ │  Trans  │ │Analytics│   │   │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘   │   │
│  │       └───────────┴──────────┬┴───────────┘         │   │
│  │                              │                       │   │
│  │  ┌───────────────────────────▼───────────────────┐  │   │
│  │  │                 Prisma ORM                     │  │   │
│  │  └───────────────────────────┬───────────────────┘  │   │
│  └──────────────────────────────┼──────────────────────┘   │
│                                 │                           │
└─────────────────────────────────┼───────────────────────────┘
                                  │
┌─────────────────────────────────▼───────────────────────────┐
│                       PostgreSQL                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │
│  │  Users  │ │Accounts │ │  Trans  │ │Budgets  │          │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘          │
└─────────────────────────────────────────────────────────────┘
```

## Принципы архитектуры

### Frontend: Feature-Sliced Design (FSD)

Методология организации кода по слоям:

| Слой | Назначение | Пример |
|------|------------|--------|
| `app` | Инициализация приложения | Провайдеры, роутинг |
| `pages` | Страницы | DashboardPage, TransactionsPage |
| `widgets` | Крупные UI-блоки | MainLayout, AuthLayout |
| `features` | Бизнес-фичи | (будущее расширение) |
| `entities` | Бизнес-сущности | User, Transaction |
| `shared` | Общий код | API, UI-компоненты, утилиты |

### Backend: Модульная архитектура NestJS

Каждый модуль инкапсулирует:
- Controller — обработка HTTP запросов
- Service — бизнес-логика
- DTOs — валидация входных данных
- Entities — типы данных (через Prisma)

### База данных: Prisma ORM

- Типобезопасные запросы
- Автоматические миграции
- Prisma Studio для визуального управления

## Потоки данных

### Аутентификация

```
1. POST /api/auth/login { email, password }
2. Backend проверяет credentials
3. Возвращает { accessToken, refreshToken }
4. Frontend сохраняет в Zustand store
5. Все запросы с Authorization: Bearer {token}
6. При истечении — автоматический refresh
```

### Создание транзакции

```
1. Пользователь заполняет форму
2. POST /api/transactions { amount, categoryId, ... }
3. Backend валидирует данные
4. Обновляет баланс счёта
5. Сохраняет транзакцию в БД
6. Возвращает созданную транзакцию
7. Frontend инвалидирует кэш (TanStack Query)
8. UI обновляется автоматически
```

## Безопасность

- **JWT** с коротким временем жизни (15 мин)
- **Refresh Token** для обновления сессии
- **Bcrypt** для хэширования паролей
- **Rate Limiting** для защиты от брутфорса
- **CORS** только для разрешённых доменов
- **Валидация** всех входных данных через class-validator
