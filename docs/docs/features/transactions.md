---
sidebar_position: 2
---

# Транзакции

## Описание

Транзакции — записи о доходах и расходах.

## Типы транзакций

| Тип | Описание | Влияние на баланс |
|-----|----------|-------------------|
| `INCOME` | Доход | + |
| `EXPENSE` | Расход | - |

## Поля транзакции

| Поле | Описание | Обязательно |
|------|----------|-------------|
| `amount` | Сумма | Да |
| `type` | Тип (INCOME/EXPENSE) | Да |
| `accountId` | Счёт | Да |
| `categoryId` | Категория | Да |
| `date` | Дата | Да |
| `description` | Описание | Нет |
| `tagIds` | Теги | Нет |

## Функции

### Создание

При создании:
- Автоматически обновляется баланс счёта
- INCOME → баланс увеличивается
- EXPENSE → баланс уменьшается

**Валидация баланса:**
- Расход не может превышать доступный баланс счёта
- При попытке создать расход больше баланса — ошибка 400
- В форме отображается доступный остаток на выбранном счёте

### Редактирование

При изменении:
- Старая сумма откатывается
- Новая сумма применяется
- Можно изменить счёт, категорию, дату

**Валидация баланса:**
- При увеличении суммы расхода проверяется достаточность средств
- При смене счёта проверяется баланс нового счёта

### Удаление

- Баланс счёта восстанавливается
- Транзакция удаляется из БД

### Фильтрация

- По периоду (dateFrom, dateTo)
- По типу (INCOME/EXPENSE)
- По счёту
- По категории
- Поиск по описанию

### Статистика

Для выбранного периода:
- Сумма доходов
- Сумма расходов
- Экономия (доходы - расходы)

:::note Терминология
**Общий баланс** — сумма остатков всех счетов (отображается на дашборде).
**Экономия** — разница между доходами и расходами за период (отображается на странице транзакций).
:::

## Переводы между счетами

Отдельная сущность `Transfer`:
- Списание с одного счёта
- Зачисление на другой
- Не влияет на общий баланс

## API

```http
GET    /api/transactions           # Список с фильтрами
POST   /api/transactions           # Создать
GET    /api/transactions/:id       # Получить
PATCH  /api/transactions/:id       # Обновить
DELETE /api/transactions/:id       # Удалить
GET    /api/transactions/stats     # Статистика
```

## Примеры

### Создание расхода

```json
POST /api/transactions
{
  "amount": 500,
  "type": "EXPENSE",
  "accountId": "account-uuid",
  "categoryId": "category-uuid",
  "date": "2024-01-15T12:00:00.000Z",
  "description": "Обед в кафе",
  "tagIds": ["tag-uuid-1", "tag-uuid-2"]
}
```

### Фильтрация

```http
GET /api/transactions?dateFrom=2024-01-01&dateTo=2024-01-31&type=EXPENSE&categoryId=uuid
```

### Ответ со статистикой

```json
GET /api/transactions/stats

{
  "income": 150000,
  "expense": 85000,
  "savings": 65000
}
```

### Ошибка при недостаточном балансе

```json
POST /api/transactions
{
  "amount": 100000,
  "type": "EXPENSE",
  "accountId": "account-uuid",
  ...
}

// Ответ 400:
{
  "statusCode": 400,
  "message": "Недостаточно средств на счёте. Доступно: 50000.00"
}
```
